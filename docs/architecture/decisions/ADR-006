# ADR-006: Worldview Pattern for Domain Knowledge

**Status**: Accepted

**Date**: 2024-11-02

---

## Decision

Each module provides **realistic domain data as code** in the `worldview-loader` module. This serves as test data, living documentation, and shared domain vocabulary.

---

## Structure

Worldview data is defined in the `worldview-loader` module and loaded on application startup (non-production only).

```
worldview-loader/
├── WorldviewProduct.kt
├── WorldviewUser.kt
├── WorldviewWarehouse.kt
└── WorldviewDataLoader.kt
```

---

## Worldview Objects

Define realistic, named instances:

```kotlin
object WorldviewProduct {
    val organicCottonTShirt = Product(
        id = ProductId("PROD-001"),
        name = "Organic Cotton T-Shirt",
        category = ProductCategory.CLOTHING,
        price = Money(BigDecimal("29.99"), EUR),
        weight = Weight(150, GRAMS)
    )

    val bambooToothbrush = Product(
        id = ProductId("PROD-002"),
        name = "Bamboo Toothbrush Set (4 pack)",
        category = ProductCategory.HOUSEHOLD,
        price = Money(BigDecimal("12.50"), EUR),
        weight = Weight(80, GRAMS)
    )
}

object WorldviewUser {
    val johnDoe = User(
        id = UserId("USER-001"),
        email = "john.doe@example.com",
        name = "John Doe",
        address = Address("Prinsengracht 263", "Amsterdam", "1016HV", Country.NETHERLANDS)
    )
}
```

---

## Builder Functions

Provide builders with sensible defaults:

```kotlin
fun buildProduct(
    id: ProductId = ProductId.generate(),
    name: String = "Test Product",
    category: ProductCategory = ProductCategory.HOUSEHOLD,
    price: Money = Money(BigDecimal("19.99"), EUR),
    weight: Weight = Weight(100, GRAMS)
): Product = Product(id, name, category, price, weight)
```

---

## Data Loader

Load worldview data on startup:

```kotlin
@Component
class WorldviewDataLoader(
    private val productRepository: ProductRepository,
    private val userRepository: UserRepository,
    @Value("\${spring.profiles.active:}") private val activeProfile: String
) {
    @PostConstruct
    fun loadWorldviewData() {
        if (activeProfile.contains("prod")) return

        productRepository.save(WorldviewProduct.organicCottonTShirt)
        productRepository.save(WorldviewProduct.bambooToothbrush)
        userRepository.save(WorldviewUser.johnDoe)
    }
}
```

---

## Usage in Tests

**Unit tests:** Reference worldview data directly
```kotlin
@Test
fun `should calculate shipping for heavy products`() {
    val product = WorldviewProduct.organicCottonTShirt
    val cost = shippingService.calculateCost(product.weight)
    assertThat(cost.amount).isGreaterThan(BigDecimal("5.00"))
}
```

**Integration tests:** Use builders
```kotlin
@Test
fun `should persist product`() {
    val product = buildProduct(name = "Test Eco Bag")
    val saved = productRepository.save(product)
    assertThat(saved.id).isNotNull()
}
```

**Cucumber tests:** Reference by name
```gherkin
Given the product "Organic Cotton T-Shirt" exists
And the customer "John Doe" is logged in
When the customer places an order for 2 "Organic Cotton T-Shirt"
```

---

## Key Principles

- Use realistic data (actual product names, weights, prices)
- Keep IDs stable (never change worldview IDs)
- Cover edge cases (very light/heavy, expensive/cheap)
- Never load in production

---

## Consequences

**Positive:** Shared vocabulary, realistic test data, living documentation, consistent across tests

**Negative:** Additional maintenance, can grow large over time
